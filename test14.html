<!DOCTYPE html>
<html lang="ja"><head></head>
<body>
<script>
var data = "";
var xhr = null; 
try { xhr = new ActiveXObject("Microsoft.XMLHTTP"); } catch (e) { xhr = new XMLHttpRequest(); }

//var path = "test.csv";
var path;

if (location.search == ""){
 path = "top.txt";
}else{
 path = location.search.replace("?", "");
}
//var path = location.hash.replace("#", "");

//console.log(location);

xhr.open("GET", path, true);
xhr.onreadystatechange = function(){
    if(xhr.readyState === 4) {
        data = xhr.responseText; 
        //console.log(data);
    }
};
xhr.send();

var table = false;
var ul = 0;
var ol = 0;
data.split("\n").forEach(function(v,i,a){
  var result;
  result = v;
  var br = true;
  
  result = result.replace(/\[\[([^\[\]]+)\]\]/g, "<a href=?$1.txt>$1</a>");

  if (result.match(/h(\d)\.\s(.*)/)){
    result = result.replace(/h(\d)\.\s(.*)/,  "<h$1>$2</h$1>");
    br = false;
  }

 if (result.match(/^\|.*\|/)){
  result = result.replace(/^\|(.*)\|/, "<tr><td>$1</td></tr>");
  result = result.replace(/\|/g, "</td><td>");
  if (table == false) {
   table = true;
   result = "<table border=1>" + result;    
  }
  br = false;
} else {
 if (table){
   table = false;
   result = result + "</table>";
  }
}

if (result.match(/^\*+\s/)) {
ulres = result.match(/^(\*+)\s+/);
//console.log(ulres);
ullen = ulres[1].length;
//console.log(ullen);
result = result.replace(/^(\*+)\s+(.*)/, "<li>$2</li>");
while(ullen > ul){
  ul ++;
  result = "<ul>" + result;
}
while(ullen < ul){
  ul --;
  result = "</ul>" + result ;
}
while(ol > ul){
  ol --;
  result = "</ol>" + result;
}br = false;
}
// else{
//  while(ul){
//   ul--;
//   result = "</ul>" + result;
//  }
//}

if (result.match(/^\#+\s/)) {
olres = result.match(/^(\#+)\s+/);
//console.log(olres);
ollen = olres[1].length;
//console.log(ollen);
result = result.replace(/^(\#+)\s+(.*)/, "<li>$2</li>");

while(ollen > ol){
  ol ++;
  result = "<ol>" + result;
}

while(ollen < ol){
  ol --;
  result = "</ol>" + result ;
}
while(ul > ol){
  ul --;
  result = "</ul>" + result;
}br = false;
}
// else {
//  while(ol){
//   ol--;
//   result = "</ol>" + result ;
//  }
//}

  if (br) {
  result = result + "<br>";

  while(ol){
   ol--;
   result = "</ol>" + result ;
  }

  while(ul){
   ul--;
   result = "</ul>" + result;
  }


 }

  console.log(result);
  document.write(result);
  
});

</script>
</body>
</html>